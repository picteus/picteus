generator client {
  provider      = "prisma-client"
  binaryTargets = ["native"]
  output        = "../src/generated/prisma-client"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Settings {
  id    Int    @id @default(autoincrement())
  type  String @unique
  value String
}

model ApiSecret {
  id             Int       @id @default(autoincrement())
  type           String
  creationDate   DateTime  @default(now())
  expirationDate DateTime?
  name           String    @unique
  comment        String?
  scope          String?
  value          String
}

model ExtensionSettings {
  id          Int    @id @default(autoincrement())
  extensionId String @unique
  value       String
}

model Repository {
  id               String   @id @default(uuid())
  technicalId      String?  @unique
  type             String
  url              String   @unique
  name             String   @unique
  comment          String?
  status           String
  creationDate     DateTime @default(now())
  modificationDate DateTime @updatedAt
  Image            Image[]
}

model Image {
  id                   String            @id @default(uuid())
  name                 String
  repository           Repository?       @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  repositoryId         String
  parentId             String?
  parent               Image?            @relation("precedence", fields: [parentId], references: [id])
  children             Image[]           @relation("precedence")
  creationDate         DateTime          @default(now())
  modificationDate     DateTime          @updatedAt
  format               String
  url                  String
  internalId           String
  sourceUrl            String?
  sizeInBytes          Int
  width                Int
  height               Int
  fileCreationDate     DateTime
  fileModificationDate DateTime
  metadata             ImageMetadata?
  features             ImageFeature[]
  tags                 ImageTag[]
  ImageAttachment      ImageAttachment[]

  @@index([name])
  @@index([format])
  @@index([url])
  @@index([sourceUrl])
  @@index([sizeInBytes])
  @@index([width])
  @@index([height])
}

model ImageMetadata {
  id               Int     @id @default(autoincrement())
  others           String?
  all              String?
  exif             String?
  icc              String?
  iptc             String?
  xmp              String?
  tiffTagPhotoshop String?
  image            Image   @relation(fields: [imageId], references: [id], onDelete: Cascade)
  imageId          String  @unique
}

model ImageFeature {
  id          Int     @id @default(autoincrement())
  type        String
  format      String  @default("string")
  extensionId String
  name        String?
  value       String
  image       Image   @relation(fields: [imageId], references: [id], onDelete: Cascade)
  imageId     String

  @@index([type])
  @@index([format])
  @@index([extensionId])
  @@index([name])
  @@index([imageId])
}

model ImageTag {
  id          Int    @id @default(autoincrement())
  value       String
  extensionId String
  image       Image  @relation(fields: [imageId], references: [id], onDelete: Cascade)
  imageId     String

  @@index([value])
  @@index([extensionId])
  @@index([imageId])
}

model ImageAttachment {
  id          Int    @id @default(autoincrement())
  imageId     String
  image       Image  @relation(fields: [imageId], references: [id], onDelete: Cascade)
  extensionId String
  mimeType    String
  value       Bytes

  @@index([imageId])
  @@index([extensionId])
  @@index([mimeType])
}
